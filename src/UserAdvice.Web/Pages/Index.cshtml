@page "{categoryUrl?}"
@model IndexModel
@{
    ViewData["Title"] = "Home page";

    var isScoped = Model.CurrentCategory != null;
    if (isScoped)
    {
        ViewData["CategoryId"] = Model.CurrentCategory.Id;
    }
    var showCategories = !isScoped && Model.Categories.Any();
    var categoryDescription = isScoped ? Model.CurrentCategory : (ViewModel.ICategory)Model.Options;

    var showPosts = isScoped || Model.Posts.Any();
}

@if (showCategories)
{
<div class="d-flex flex-wrap align-content-stretch m-1">
    @foreach (var cat in Model.Categories.OrderByDescending(x => x.SortKey).ThenBy(x => x.Name))
    {
        <div class="col-lg-6 my-1">
            <partial name="Category/_Card" model="cat" />
        </div>
        <div class="col-lg-6 my-1">
            <partial name="Category/_Card" model="cat" />
        </div>
    }
</div>
}

<partial name="Category/_Description" model="categoryDescription" />

@if (showPosts)
{
    @if (Model.Posts.Any())
    {
        @foreach (var post in Model.Posts.OrderByDescending(x => x.CreatedAt))
        {
            <partial name="Post/_Teaser" model="post" view-data="ViewData" />
        }

    }
    else
    {
        <p>-Keine Beiträge -</p>
    }
}
